"use strict";(self["webpackChunkteacher_project"]=self["webpackChunkteacher_project"]||[]).push([[7930],{87930:function(t,e,s){s.r(e),s.d(e,{default:function(){return u}});var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("a-modal",{attrs:{width:1340,closable:!1,centered:""},model:{value:t.showModal,callback:function(e){t.showModal=e},expression:"showModal"}},[s("tab",{staticStyle:{background:"#f6f5fa"},attrs:{tabIndex:t.tabIndex,"tab-data":t.isEditing?t.tabData.filter((function(e){return e.id===t.tabIndex})):t.tabData},on:{changeIndex:t.changeIndex}}),s("div",{staticClass:"recordBox"},[s("div",{staticClass:"left"},[s("h3",[s("span",[t._v("录入题干:")]),s("input",{ref:"quesAttachment",attrs:{type:"file"},on:{change:function(e){return t.upload(e)}}})]),s("Editor",{ref:"question",attrs:{height:410,"show-toolbar":!1}}),s("h3",[s("span",[t._v("答案:")]),0===t.tabIndex||1===t.tabIndex?s("a-button",{attrs:{size:"small"},on:{click:t.addAnswerItem}},[t._v(" 添加选项区 ")]):t._e()],1),[0,1].includes(t.tabIndex)?s("div",{staticClass:"answerBox"},t._l(t.answerData,(function(e,n){return s("div",{key:e.id,staticClass:"answer"},[s("span",[t._v(t._s(n+1))]),s("ul",[t._l(e.items,(function(a,i){return s("li",{key:i},[i>3&&i===e.items.length-1?s("a-icon",{staticClass:"delete",attrs:{type:"close-circle"},on:{click:function(e){return t.deleteAnswerItem(n,i)}}}):t._e(),s("a-button",{attrs:{type:e.answerArr.includes(a)?"primary":null},on:{click:function(e){return t.itemClicked(n,a)}}},[t._v(" "+t._s(a)+" ")])],1)})),s("li",[t.itemNumber<10?s("a-button",{attrs:{type:"dashed"},on:{click:function(e){return t.changeItemNumber(t.itemNumber+1)}}},[t._v(" + ")]):t._e()],1),s("li",[n>0?s("a-button",{attrs:{type:"danger"},on:{click:function(e){return t.deleteItem(n)}}},[t._v(" 删除 ")]):t._e()],1)],2)])})),0):s("Editor",{ref:"answer",attrs:{height:255,"show-toolbar":!1}})],1),s("div",{staticClass:"right"},[s("h3",[s("span",[t._v("解析:")])]),s("Editor",{ref:"analysis",attrs:{height:560,"show-toolbar":!1}}),s("h3",[s("span",[t._v("附件")])]),s("a-upload",{attrs:{action:"https://www.mocky.io/v2/5cc8019d300000980a055e76",multiple:!0,"file-list":t.fileList},on:{change:t.handleChange}},[s("a-button",[s("a-icon",{attrs:{type:"upload"}}),t._v(" 上传附件 ")],1)],1)],1)]),s("template",{slot:"footer"},[s("a-button",{on:{click:function(e){t.showModal=!1}}},[t._v(" 取消")]),t.isEditing?s("a-button",{attrs:{type:"primary"},on:{click:t.changeCourseQuestion}},[t._v(" 修改试题 ")]):[s("a-button",{on:{click:function(e){return t.addCourseQuestion(0)}}},[t._v(" 确定并退出 ")]),s("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.addCourseQuestion(1)}}},[t._v(" 确定并继续 ")])]],2)],2)},a=[],i=(s(69418),s(35462)),r=s(26490),o={name:"RecordQuestions",props:{data:{type:Object},isEditing:{type:Boolean,default:()=>!1}},components:{Tab:()=>s.e(760).then(s.bind(s,60760)),Editor:()=>s.e(7415).then(s.bind(s,17415))},data(){return{tabData:[{id:0,name:"单选"},{id:1,name:"不定项"},{id:2,name:"填空"},{id:3,name:"简答"}],showModal:!1,tabIndex:0,itemNumber:4,answerData:[{id:"0",items:["A","B","C","D"],answerArr:[]}],attachmentMappingList:{attachmentId:null,attachmentType:1},fileList:[],questionNumber:1}},computed:{...(0,r.rn)({courseId:t=>t.c.courseId,courseContentId:t=>t.c.courseContentId,contentData:t=>t.c.contentData}),...(0,r.Se)("c",["courseSelectedItemData"]),answerItems(){return Array.from(new Array(this.itemNumber),((t,e)=>String.fromCharCode(65+e)))},rightAnswer(){return this.answerData.map((t=>0===this.tabIndex?t.answerArr.toString():t.answerArr.sort().join("")))}},mounted(){},methods:{...(0,r.OI)("c",["replaceContent"]),changeIndex(t){this.tabIndex=t,0===t||1===t?this.answerData=[{id:"0",items:["A","B","C","D"],answerArr:[]}]:this.$refs.answer.html="",this.$refs.question.html="",this.$refs.analysis.html=""},upload(t){let e=t.target.files[0];(0,i.ws)({uploadFile:e}).then((t=>{this.attachmentMappingList.attachmentId=t.extra.id}))},addCourseQuestion(t){if(console.log(this.rightAnswer.includes("")),this.$refs.question.editor.isEmpty())return void this.$message.warn("题干不能为空！");if(this.$refs.analysis.editor.isEmpty())return void this.$message.warn("解析不能为空！");if([0,1].includes(this.tabIndex)&&this.rightAnswer.includes(""))return void this.$message.warn("请选择答案！");0===t&&(this.questionNumber=1);let e={entity:{courseId:parseInt(this.courseId),questionType:this.tabIndex,questionStem:`${this.$refs.question.html}`,answerCard:[0,1].includes(this.tabIndex)?this.answerItems.toString():null,chooseZoneCounts:this.answerData.length,answer:[0,1].includes(this.tabIndex)?this.rightAnswer.toString():this.$refs.answer.html,questionAnalysis:`${this.$refs.analysis.html}`,questionScore:1,questionNumber:this.questionNumber,questionIndex:1}};if(this.$refs.quesAttachment.files.length>0&&(e.attachmentMappingList=[this.attachmentMappingList]),""===this.courseContentId)e.questionIndex=this.contentData.length+1,(0,i.n2)(e).then((e=>{this.replaceContent([...this.contentData,e.extra]),this.$refs.question.clear(),[2,3].includes(this.tabIndex)&&this.$refs.answer.clear(),this.$refs.analysis.clear(),0===t?this.showModal=!1:(this.questionNumber+=1,this.$message.success("添加成功！"))}));else{let s=this.contentData.findIndex((t=>t.content.id===this.courseContentId));if(2===this.contentData[s].contentType){let n=this.contentData[s].content.mappingIdList;if(n.length>0){let s=this.contentData.findIndex((t=>t.content.id===n[n.length-1]));e.questionIndex=this.contentData[s].content.questionIndex+1,(0,i.n2)(e).then((e=>{this.contentData.splice(s+1,0,e.extra),this.replaceContent(this.contentData),this.$refs.question.clear(),[2,3].includes(this.tabIndex)&&this.$refs.answer.clear(),this.$refs.analysis.clear(),0===t?this.showModal=!1:(this.questionNumber+=1,this.$message.success("添加成功！"))}))}return}e.questionIndex=this.contentData[s].content.questionIndex+1,(0,i.n2)(e).then((e=>{this.contentData.splice(s+1,0,e.extra),this.replaceContent(this.contentData),this.$refs.question.clear(),[2,3].includes(this.tabIndex)&&this.$refs.answer.clear(),this.$refs.analysis.clear(),0===t?this.showModal=!1:(this.questionNumber+=1,this.$message.success("添加成功！"))}))}},changeCourseQuestion(){if(this.$refs.question.editor.isEmpty())return void this.$message.warn("题干不能为空！");if(this.$refs.analysis.editor.isEmpty())return void this.$message.warn("解析不能为空！");if([0,1].includes(this.tabIndex)&&this.rightAnswer.includes(""))return void this.$message.warn("请选择答案！");let t={entity:{addToQuestionAnalysis:null,answer:[0,1].includes(this.tabIndex)?this.rightAnswer.toString():this.$refs.answer.html,answerCard:[0,1].includes(this.tabIndex)?this.answerItems.toString():null,courseId:parseInt(this.courseId),id:this.data.id,questionAnalysis:`${this.$refs.analysis.html}`,questionNumber:this.data.questionNumber,questionScore:this.data.questionScore,questionStem:`${this.$refs.question.html}`,chooseZoneCounts:this.answerData.length,questionType:this.tabIndex}};this.$refs.quesAttachment.files.length>0&&(t.attachmentMappingList=[this.attachmentMappingList]),(0,i.tm)(t).then((t=>{let e=this.contentData.findIndex((t=>t.content.id===this.courseContentId));this.contentData[e]=t.extra,this.replaceContent(this.contentData),this.showModal=!1}))},changeItemNumber(t){t>10||(this.itemNumber=t,this.answerData.forEach((t=>{t.items=this.answerItems})))},addAnswerItem(){this.answerData.push({id:(new Date).getTime(),items:this.answerItems,answerArr:[]})},deleteItem(t){this.answerData.splice(t,1)},deleteAnswerItem(t,e){this.itemNumber-=1,this.answerData[t].items.splice(e,1)},itemClicked(t,e){0===this.tabIndex?this.answerData[t].answerArr.includes(e)?this.answerData[t].answerArr=[]:(this.answerData[t].answerArr=[],this.answerData[t].answerArr.push(e)):1===this.tabIndex&&(this.answerData[t].answerArr.includes(e)?this.answerData[t].answerArr=this.answerData[t].answerArr.filter((t=>t!==e)):this.answerData[t].answerArr.push(e))},handleChange(t){let e=[...t.fileList];e=e.slice(-5),e=e.map((t=>(t.response&&(t.url=t.response.url),t))),this.fileList=e},setQuestionStem(t){this.$nextTick((()=>{this.$refs.question.setHtml(t)}))},setQuestionAnalysis(t){this.$nextTick((()=>{this.$refs.analysis.setHtml(t)}))}}},h=o,c=s(35471),l=(0,c.Z)(h,n,a,!1,null,"428af5c7",null),u=l.exports}}]);