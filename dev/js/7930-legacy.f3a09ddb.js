"use strict";(self["webpackChunkteacher_project"]=self["webpackChunkteacher_project"]||[]).push([[7930],{87930:function(t,e,n){n.r(e),n.d(e,{default:function(){return f}});var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a-modal",{attrs:{width:1340,closable:!1,centered:""},model:{value:t.showModal,callback:function(e){t.showModal=e},expression:"showModal"}},[n("tab",{staticStyle:{background:"#f6f5fa"},attrs:{tabIndex:t.tabIndex,"tab-data":t.isEditing?t.tabData.filter((function(e){return e.id===t.tabIndex})):t.tabData},on:{changeIndex:t.changeIndex}}),n("div",{staticClass:"recordBox"},[n("div",{staticClass:"left"},[n("h3",[n("span",[t._v("录入题干:")]),n("input",{ref:"quesAttachment",attrs:{type:"file"},on:{change:function(e){return t.upload(e)}}})]),n("Editor",{ref:"question",attrs:{height:410,"show-toolbar":!1}}),n("h3",[n("span",[t._v("答案:")]),0===t.tabIndex||1===t.tabIndex?n("a-button",{attrs:{size:"small"},on:{click:t.addAnswerItem}},[t._v(" 添加选项区 ")]):t._e()],1),[0,1].includes(t.tabIndex)?n("div",{staticClass:"answerBox"},t._l(t.answerData,(function(e,s){return n("div",{key:e.id,staticClass:"answer"},[n("span",[t._v(t._s(s+1))]),n("ul",[t._l(e.items,(function(a,i){return n("li",{key:i},[i>3&&i===e.items.length-1?n("a-icon",{staticClass:"delete",attrs:{type:"close-circle"},on:{click:function(e){return t.deleteAnswerItem(s,i)}}}):t._e(),n("a-button",{attrs:{type:e.answerArr.includes(a)?"primary":null},on:{click:function(e){return t.itemClicked(s,a)}}},[t._v(" "+t._s(a)+" ")])],1)})),n("li",[t.itemNumber<10?n("a-button",{attrs:{type:"dashed"},on:{click:function(e){return t.changeItemNumber(t.itemNumber+1)}}},[t._v(" + ")]):t._e()],1),n("li",[s>0?n("a-button",{attrs:{type:"danger"},on:{click:function(e){return t.deleteItem(s)}}},[t._v(" 删除 ")]):t._e()],1)],2)])})),0):n("Editor",{ref:"answer",attrs:{height:255,"show-toolbar":!1}})],1),n("div",{staticClass:"right"},[n("h3",[n("span",[t._v("解析:")])]),n("Editor",{ref:"analysis",attrs:{height:560,"show-toolbar":!1}}),n("h3",[n("span",[t._v("附件")])]),n("a-upload",{attrs:{action:"https://www.mocky.io/v2/5cc8019d300000980a055e76",multiple:!0,"file-list":t.fileList},on:{change:t.handleChange}},[n("a-button",[n("a-icon",{attrs:{type:"upload"}}),t._v(" 上传附件 ")],1)],1)],1)]),n("template",{slot:"footer"},[n("a-button",{on:{click:function(e){t.showModal=!1}}},[t._v(" 取消")]),t.isEditing?n("a-button",{attrs:{type:"primary"},on:{click:t.changeCourseQuestion}},[t._v(" 修改试题 ")]):[n("a-button",{on:{click:function(e){return t.addCourseQuestion(0)}}},[t._v(" 确定并退出 ")]),n("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.addCourseQuestion(1)}}},[t._v(" 确定并继续 ")])]],2)],2)},a=[],i=n(87115),r=n(7204),o=(n(21206),n(68428),n(58742),n(22958),n(99258),n(54779),n(70530),n(48106),n(69418),n(13176),n(8700),n(52892),n(57757),n(99453),n(66359),n(3242),n(35462)),c=n(26490),u={name:"RecordQuestions",props:{data:{type:Object},isEditing:{type:Boolean,default:function(){return!1}}},components:{Tab:function(){return n.e(760).then(n.bind(n,60760))},Editor:function(){return n.e(7658).then(n.bind(n,57658))}},data:function(){return{tabData:[{id:0,name:"单选"},{id:1,name:"不定项"},{id:2,name:"填空"},{id:3,name:"简答"}],showModal:!1,tabIndex:0,itemNumber:4,answerData:[{id:"0",items:["A","B","C","D"],answerArr:[]}],attachmentMappingList:{attachmentId:null,attachmentType:1},fileList:[],questionNumber:1}},computed:(0,r.Z)((0,r.Z)((0,r.Z)({},(0,c.rn)({courseId:function(t){return t.c.courseId},courseContentId:function(t){return t.c.courseContentId},contentData:function(t){return t.c.contentData}})),(0,c.Se)("c",["courseSelectedItemData"])),{},{answerItems:function(){return Array.from(new Array(this.itemNumber),(function(t,e){return String.fromCharCode(65+e)}))},rightAnswer:function(){var t=this;return this.answerData.map((function(e){return 0===t.tabIndex?e.answerArr.toString():e.answerArr.sort().join("")}))}}),mounted:function(){},methods:(0,r.Z)((0,r.Z)({},(0,c.OI)("c",["replaceContent"])),{},{changeIndex:function(t){this.tabIndex=t,0===t||1===t?this.answerData=[{id:"0",items:["A","B","C","D"],answerArr:[]}]:this.$refs.answer.html="",this.$refs.question.html="",this.$refs.analysis.html=""},upload:function(t){var e=this,n=t.target.files[0];(0,o.ws)({uploadFile:n}).then((function(t){e.attachmentMappingList.attachmentId=t.extra.id}))},addCourseQuestion:function(t){var e=this;if(console.log(this.rightAnswer.includes("")),this.$refs.question.editor.isEmpty())this.$message.warn("题干不能为空！");else if(this.$refs.analysis.editor.isEmpty())this.$message.warn("解析不能为空！");else if([0,1].includes(this.tabIndex)&&this.rightAnswer.includes(""))this.$message.warn("请选择答案！");else{0===t&&(this.questionNumber=1);var n={entity:{courseId:parseInt(this.courseId),questionType:this.tabIndex,questionStem:"".concat(this.$refs.question.html),answerCard:[0,1].includes(this.tabIndex)?this.answerItems.toString():null,chooseZoneCounts:this.answerData.length,answer:[0,1].includes(this.tabIndex)?this.rightAnswer.toString():this.$refs.answer.html,questionAnalysis:"".concat(this.$refs.analysis.html),questionScore:1,questionNumber:this.questionNumber,questionIndex:1}};if(this.$refs.quesAttachment.files.length>0&&(n.attachmentMappingList=[this.attachmentMappingList]),""===this.courseContentId)n.questionIndex=this.contentData.length+1,(0,o.n2)(n).then((function(n){e.replaceContent([].concat((0,i.Z)(e.contentData),[n.extra])),e.$refs.question.clear(),[2,3].includes(e.tabIndex)&&e.$refs.answer.clear(),e.$refs.analysis.clear(),0===t?e.showModal=!1:(e.questionNumber+=1,e.$message.success("添加成功！"))}));else{var s=this.contentData.findIndex((function(t){return t.content.id===e.courseContentId}));if(2===this.contentData[s].contentType){var a=this.contentData[s].content.mappingIdList;if(a.length>0){var r=this.contentData.findIndex((function(t){return t.content.id===a[a.length-1]}));n.questionIndex=this.contentData[r].content.questionIndex+1,(0,o.n2)(n).then((function(n){e.contentData.splice(r+1,0,n.extra),e.replaceContent(e.contentData),e.$refs.question.clear(),[2,3].includes(e.tabIndex)&&e.$refs.answer.clear(),e.$refs.analysis.clear(),0===t?e.showModal=!1:(e.questionNumber+=1,e.$message.success("添加成功！"))}))}return}n.questionIndex=this.contentData[s].content.questionIndex+1,(0,o.n2)(n).then((function(n){e.contentData.splice(s+1,0,n.extra),e.replaceContent(e.contentData),e.$refs.question.clear(),[2,3].includes(e.tabIndex)&&e.$refs.answer.clear(),e.$refs.analysis.clear(),0===t?e.showModal=!1:(e.questionNumber+=1,e.$message.success("添加成功！"))}))}}},changeCourseQuestion:function(){var t=this;if(this.$refs.question.editor.isEmpty())this.$message.warn("题干不能为空！");else if(this.$refs.analysis.editor.isEmpty())this.$message.warn("解析不能为空！");else if([0,1].includes(this.tabIndex)&&this.rightAnswer.includes(""))this.$message.warn("请选择答案！");else{var e={entity:{addToQuestionAnalysis:null,answer:[0,1].includes(this.tabIndex)?this.rightAnswer.toString():this.$refs.answer.html,answerCard:[0,1].includes(this.tabIndex)?this.answerItems.toString():null,courseId:parseInt(this.courseId),id:this.data.id,questionAnalysis:"".concat(this.$refs.analysis.html),questionNumber:this.data.questionNumber,questionScore:this.data.questionScore,questionStem:"".concat(this.$refs.question.html),chooseZoneCounts:this.answerData.length,questionType:this.tabIndex}};this.$refs.quesAttachment.files.length>0&&(e.attachmentMappingList=[this.attachmentMappingList]),(0,o.tm)(e).then((function(e){var n=t.contentData.findIndex((function(e){return e.content.id===t.courseContentId}));t.contentData[n]=e.extra,t.replaceContent(t.contentData),t.showModal=!1}))}},changeItemNumber:function(t){var e=this;t>10||(this.itemNumber=t,this.answerData.forEach((function(t){t.items=e.answerItems})))},addAnswerItem:function(){this.answerData.push({id:(new Date).getTime(),items:this.answerItems,answerArr:[]})},deleteItem:function(t){this.answerData.splice(t,1)},deleteAnswerItem:function(t,e){this.itemNumber-=1,this.answerData[t].items.splice(e,1)},itemClicked:function(t,e){0===this.tabIndex?this.answerData[t].answerArr.includes(e)?this.answerData[t].answerArr=[]:(this.answerData[t].answerArr=[],this.answerData[t].answerArr.push(e)):1===this.tabIndex&&(this.answerData[t].answerArr.includes(e)?this.answerData[t].answerArr=this.answerData[t].answerArr.filter((function(t){return t!==e})):this.answerData[t].answerArr.push(e))},handleChange:function(t){var e=(0,i.Z)(t.fileList);e=e.slice(-5),e=e.map((function(t){return t.response&&(t.url=t.response.url),t})),this.fileList=e},setQuestionStem:function(t){var e=this;this.$nextTick((function(){e.$refs.question.setHtml(t)}))},setQuestionAnalysis:function(t){var e=this;this.$nextTick((function(){e.$refs.analysis.setHtml(t)}))}})},h=u,l=n(35471),d=(0,l.Z)(h,s,a,!1,null,"428af5c7",null),f=d.exports}}]);