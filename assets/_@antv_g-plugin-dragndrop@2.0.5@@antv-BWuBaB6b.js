import{_ as S,d as B,g as R,h as T}from"./_tslib@2.6.3@tslib-Ck5hgXZz.js";import{A as k}from"./_@antv_g-lite@2.0.5@@antv-O0rSGUp-.js";import{J as A}from"./_@antv_util@3.3.7@@antv-rk1Gsl7O.js";var b=function(){function r(n){this.dragndropPluginOptions=n}return r.prototype.apply=function(n){var a=this,s=n.renderingService,X=n.renderingContext,p=X.root.ownerDocument,c=p.defaultView,P=function(d){var e=d.target,E=e===p,g=E&&a.dragndropPluginOptions.isDocumentDraggable?p:e.closest&&e.closest("[draggable=true]");if(g){var u=!1,Y=d.timeStamp,x=[d.clientX,d.clientY],i=null,h=[d.clientX,d.clientY],w=function(t){return R(a,void 0,void 0,function(){var o,L,m,v,f,l;return T(this,function(y){switch(y.label){case 0:if(!u){if(o=t.timeStamp-Y,L=A([t.clientX,t.clientY],x),o<=this.dragndropPluginOptions.dragstartTimeThreshold||L<=this.dragndropPluginOptions.dragstartDistanceThreshold)return[2];t.type="dragstart",g.dispatchEvent(t),u=!0}return t.type="drag",t.dx=t.clientX-h[0],t.dy=t.clientY-h[1],g.dispatchEvent(t),h=[t.clientX,t.clientY],E?[3,2]:(m=this.dragndropPluginOptions.overlap==="pointer"?[t.canvasX,t.canvasY]:e.getBounds().center,[4,p.elementsFromPoint(m[0],m[1])]);case 1:v=y.sent(),f=v[v.indexOf(e)+1],l=(f==null?void 0:f.closest("[droppable=true]"))||(this.dragndropPluginOptions.isDocumentDroppable?p:null),i!==l&&(i&&(t.type="dragleave",t.target=i,i.dispatchEvent(t)),l&&(t.type="dragenter",t.target=l,l.dispatchEvent(t)),i=l,i&&(t.type="dragover",t.target=i,i.dispatchEvent(t))),y.label=2;case 2:return[2]}})})};c.addEventListener("pointermove",w);var O=function(t){if(u){t.detail={preventClick:!0};var o=t.clone();i&&(o.type="drop",o.target=i,i.dispatchEvent(o)),o.type="dragend",g.dispatchEvent(o),u=!1}c.removeEventListener("pointermove",w)};e.addEventListener("pointerup",O,{once:!0}),e.addEventListener("pointerupoutside",O,{once:!0})}};s.hooks.init.tap(r.tag,function(){c.addEventListener("pointerdown",P)}),s.hooks.destroy.tap(r.tag,function(){c.removeEventListener("pointerdown",P)})},r.tag="Dragndrop",r}(),F=function(r){S(n,r);function n(a){a===void 0&&(a={});var s=r.call(this)||this;return s.options=a,s.name="dragndrop",s}return n.prototype.init=function(){this.addRenderingPlugin(new b(B({overlap:"pointer",isDocumentDraggable:!1,isDocumentDroppable:!1,dragstartDistanceThreshold:0,dragstartTimeThreshold:0},this.options)))},n.prototype.destroy=function(){this.removeAllRenderingPlugins()},n.prototype.setOptions=function(a){Object.assign(this.plugins[0].dragndropPluginOptions,a)},n}(k);export{F as P};
