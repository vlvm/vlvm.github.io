import{_ as N,a as k,b as O}from"./_tslib@2.6.3@tslib-Ck5hgXZz.js";import{A as C,y as T,E as f,l as w,z as x,v as A,S as M}from"./_@antv_g-lite@2.0.5@@antv-O0rSGUp-.js";import{p as D,d as L,c as H}from"./_@antv_util@3.3.7@@antv-rk1Gsl7O.js";var R="g-canvas-camera",b=function(){function l(){this.displayObjectHTMLElementMap=new WeakMap}return l.prototype.joinTransformMatrix=function(t){return"matrix(".concat([t[0],t[1],t[4],t[5],t[12],t[13]].join(","),")")},l.prototype.apply=function(t,r){var e=this,v=t.camera,p=t.renderingContext,d=t.renderingService;this.context=t;var n=p.root.ownerDocument.defaultView,y=n.context.eventService.nativeHTMLMap,c=function(s,a){a.style.transform=e.joinTransformMatrix(s.getWorldTransform())},i=function(s){var a=s.target;if(a.nodeName===M.HTML){e.$camera||(e.$camera=e.createCamera(v));var o=e.getOrCreateEl(a);if(e.$camera.appendChild(o),r.enableCSSParsing){var E=a.ownerDocument.documentElement.attributes;Object.keys(E).forEach(function(S){o.style[S]=E[S]})}Object.keys(a.attributes).forEach(function(S){e.updateAttribute(S,a)}),c(a,o),y.set(o,a)}},u=function(s){var a=s.target;if(a.nodeName===M.HTML&&e.$camera){var o=e.getOrCreateEl(a);o&&(o.remove(),y.delete(o))}},m=function(s){var a=s.target;if(a.nodeName===M.HTML){var o=s.attrName;e.updateAttribute(o,a)}},h=function(s){var a=s.target;if(a.nodeName===M.HTML){var o=e.getOrCreateEl(a);c(a,o)}},g=function(){if(e.$camera){var s=e.context.config,a=s.width,o=s.height;e.$camera.style.width="".concat(a||0,"px"),e.$camera.style.height="".concat(o||0,"px")}};d.hooks.init.tap(l.tag,function(){n.addEventListener(T.RESIZE,g),n.addEventListener(f.MOUNTED,i),n.addEventListener(f.UNMOUNTED,u),n.addEventListener(f.ATTR_MODIFIED,m),n.addEventListener(f.BOUNDS_CHANGED,h)}),d.hooks.endFrame.tap(l.tag,function(){e.$camera&&p.renderReasons.has(w.CAMERA_CHANGED)&&(e.$camera.style.transform=e.joinTransformMatrix(v.getOrthoMatrix()))}),d.hooks.destroy.tap(l.tag,function(){e.$camera&&e.$camera.remove(),n.removeEventListener(T.RESIZE,g),n.removeEventListener(f.MOUNTED,i),n.removeEventListener(f.UNMOUNTED,u),n.removeEventListener(f.ATTR_MODIFIED,m),n.removeEventListener(f.BOUNDS_CHANGED,h)})},l.prototype.createCamera=function(t){var r=this.context.config,e=r.document,v=r.width,p=r.height,d=this.context.contextService.getDomElement(),n=d.parentNode;if(n){var y=R,c=n.querySelector("#"+y);if(!c){var i=(e||document).createElement("div");c=i,i.id=y,i.style.position="absolute",i.style.left="".concat(d.offsetLeft||0,"px"),i.style.top="".concat(d.offsetTop||0,"px"),i.style.transformOrigin="left top",i.style.transform=this.joinTransformMatrix(t.getOrthoMatrix()),i.style.overflow="hidden",i.style.pointerEvents="none",i.style.width="".concat(v||0,"px"),i.style.height="".concat(p||0,"px"),n.appendChild(i)}return c}return null},l.prototype.getOrCreateEl=function(t){var r=this.context.config.document,e=this.displayObjectHTMLElementMap.get(t);return e||(e=(r||document).createElement("div"),t.parsedStyle.$el=e,this.displayObjectHTMLElementMap.set(t,e),t.id&&(e.id=t.id),t.name&&e.setAttribute("name",t.name),t.className&&(e.className=t.className),e.style.position="absolute",e.style["will-change"]="transform",e.style.transform=this.joinTransformMatrix(t.getWorldTransform())),e},l.prototype.updateAttribute=function(t,r){var e=this.getOrCreateEl(r);switch(t){case"innerHTML":var v=r.parsedStyle.innerHTML;H(v)?e.innerHTML=v:(e.innerHTML="",e.appendChild(v));break;case"x":e.style.left="".concat(r.parsedStyle.x,"px");break;case"y":e.style.top="".concat(r.parsedStyle.y,"px");break;case"transformOrigin":var p=r.parsedStyle.transformOrigin;e.style["transform-origin"]="".concat(p[0].value," ").concat(p[1].value);break;case"width":if(this.context.enableCSSParsing){var d=r.computedStyleMap().get("width");e.style.width=d.toString()}else{var d=r.parsedStyle.width;e.style.width=L(d)?"".concat(d,"px"):d.toString()}break;case"height":if(this.context.enableCSSParsing){var n=r.computedStyleMap().get("height");e.style.height=n.toString()}else{var n=r.parsedStyle.height;e.style.height=L(n)?"".concat(n,"px"):n.toString()}break;case"zIndex":var y=r.parsedStyle.zIndex;e.style["z-index"]="".concat(y);break;case"visibility":var c=r.parsedStyle.visibility;e.style.visibility=c;break;case"pointerEvents":var i=r.parsedStyle.pointerEvents,u=i===void 0?"auto":i;e.style.pointerEvents=u;break;case"opacity":var m=r.parsedStyle.opacity;e.style.opacity="".concat(m);break;case"fill":var h=r.parsedStyle.fill,g="";x(h)?h.isNone?g="transparent":g=r.getAttribute("fill"):Array.isArray(h)?g=r.getAttribute("fill"):A(h),e.style.background=g;break;case"stroke":var s=r.parsedStyle.stroke,a="";x(s)?s.isNone?a="transparent":a=r.getAttribute("stroke"):Array.isArray(s)?a=r.getAttribute("stroke"):A(s),e.style["border-color"]=a,e.style["border-style"]="solid";break;case"lineWidth":var o=r.parsedStyle.lineWidth;e.style["border-width"]="".concat(o||0,"px");break;case"lineDash":e.style["border-style"]="dashed";break;case"filter":var E=r.style.filter;e.style.filter=E;break;default:!D(r.style[t])&&r.style[t]!==""&&(e.style[t]=r.style[t])}},l.tag="HTMLRendering",l}(),I=function(l){N(t,l);function t(){var r=l.apply(this,k([],O(arguments),!1))||this;return r.name="html-renderer",r}return t.prototype.init=function(){this.addRenderingPlugin(new b)},t.prototype.destroy=function(){this.removeAllRenderingPlugins()},t}(C);export{I as P};
