import{r as V,g as w,f as v,h as N,i as J,j as Y}from"./_@antv_g-lite@2.0.5@@antv-O0rSGUp-.js";import{_ as k,a as Q,b as _}from"./_tslib@2.6.3@tslib-Ck5hgXZz.js";import{c as tt,d as it}from"./_@antv_util@3.3.7@@antv-rk1Gsl7O.js";import{s as G,o as A,p as q,q as ot,e as et,r as B,u as st,v as c,w as T,x as W,y as z,l as at,z as rt,A as m,B as X,C as Z}from"./_gl-matrix@3.4.3@gl-matrix-Cx0TVU2o.js";var nt=function(M){k(r,M);function r(){var i=M.apply(this,Q([],_(arguments),!1))||this;return i.landmarks=[],i}return r.prototype.rotate=function(i,s,t){if(this.relElevation=w(s),this.relAzimuth=w(i),this.relRoll=w(t),this.elevation+=this.relElevation,this.azimuth+=this.relAzimuth,this.roll+=this.relRoll,this.type===v.EXPLORING){var e=G(A(),[1,0,0],N((this.rotateWorld?1:-1)*this.relElevation)),a=G(A(),[0,1,0],N((this.rotateWorld?1:-1)*this.relAzimuth)),n=G(A(),[0,0,1],N(this.relRoll)),l=q(A(),a,e);l=q(A(),l,n);var h=ot(et(),l);B(this.matrix,this.matrix,[0,0,-this.distance]),st(this.matrix,this.matrix,h),B(this.matrix,this.matrix,[0,0,this.distance])}else{if(Math.abs(this.elevation)>90)return this;this.computeMatrix()}return this._getAxes(),this.type===v.ORBITING||this.type===v.EXPLORING?this._getPosition():this.type===v.TRACKING&&this._getFocalPoint(),this._update(),this},r.prototype.pan=function(i,s){var t=J(i,s,0),e=c(this.position);return T(e,e,W(z(),this.right,t[0])),T(e,e,W(z(),this.up,t[1])),this._setPosition(e),this.triggerUpdate(),this},r.prototype.dolly=function(i){var s=this.forward,t=c(this.position),e=i*this.dollyingStep,a=this.distance+i*this.dollyingStep;return e=Math.max(Math.min(a,this.maxDistance),this.minDistance)-this.distance,t[0]+=e*s[0],t[1]+=e*s[1],t[2]+=e*s[2],this._setPosition(t),this.type===v.ORBITING||this.type===v.EXPLORING?this._getDistance():this.type===v.TRACKING&&T(this.focalPoint,t,this.distanceVector),this.triggerUpdate(),this},r.prototype.cancelLandmarkAnimation=function(){this.landmarkAnimationID!==void 0&&this.canvas.cancelAnimationFrame(this.landmarkAnimationID)},r.prototype.createLandmark=function(i,s){var t,e,a,n;s===void 0&&(s={});var l=s.position,h=l===void 0?this.position:l,d=s.focalPoint,p=d===void 0?this.focalPoint:d,g=s.roll,f=s.zoom,o=new V.CameraContribution;o.setType(this.type,void 0),o.setPosition(h[0],(t=h[1])!==null&&t!==void 0?t:this.position[1],(e=h[2])!==null&&e!==void 0?e:this.position[2]),o.setFocalPoint(p[0],(a=p[1])!==null&&a!==void 0?a:this.focalPoint[1],(n=p[2])!==null&&n!==void 0?n:this.focalPoint[2]),o.setRoll(g??this.roll),o.setZoom(f??this.zoom);var y={name:i,matrix:at(o.getWorldTransform()),right:c(o.right),up:c(o.up),forward:c(o.forward),position:c(o.getPosition()),focalPoint:c(o.getFocalPoint()),distanceVector:c(o.getDistanceVector()),distance:o.getDistance(),dollyingStep:o.getDollyingStep(),azimuth:o.getAzimuth(),elevation:o.getElevation(),roll:o.getRoll(),relAzimuth:o.relAzimuth,relElevation:o.relElevation,relRoll:o.relRoll,zoom:o.getZoom()};return this.landmarks.push(y),y},r.prototype.gotoLandmark=function(i,s){var t=this;s===void 0&&(s={});var e=tt(i)?this.landmarks.find(function(P){return P.name===i}):i;if(e){var a=it(s)?{duration:s}:s,n=a.easing,l=n===void 0?"linear":n,h=a.duration,d=h===void 0?100:h,p=a.easingFunction,g=p===void 0?void 0:p,f=a.onfinish,o=f===void 0?void 0:f,y=a.onframe,$=y===void 0?void 0:y,K=.01;if(d===0){this.syncFromLandmark(e),o&&o();return}this.cancelLandmarkAnimation();var x=e.position,R=e.focalPoint,E=e.zoom,I=e.roll,j=g||V.EasingFunction(l),C,b=function(){t.setFocalPoint(R),t.setPosition(x),t.setRoll(I),t.setZoom(E),t.computeMatrix(),t.triggerUpdate(),o&&o()},O=function(P){C===void 0&&(C=P);var F=P-C;if(F>d){b();return}var u=j(F/d),D=z(),L=z(),S=1,U=0;X(D,t.focalPoint,R,u),X(L,t.position,x,u),U=t.roll*(1-u)+I*u,S=t.zoom*(1-u)+E*u,t.setFocalPoint(D),t.setPosition(L),t.setRoll(U),t.setZoom(S);var H=Z(D,R)+Z(L,x);if(H<=K&&E==null&&I==null){b();return}t.computeMatrix(),t.triggerUpdate(),F<d&&($&&$(u),t.landmarkAnimationID=t.canvas.requestAnimationFrame(O))};this.canvas.requestAnimationFrame(O)}},r.prototype.syncFromLandmark=function(i){this.matrix=rt(this.matrix,i.matrix),this.right=m(this.right,i.right),this.up=m(this.up,i.up),this.forward=m(this.forward,i.forward),this.position=m(this.position,i.position),this.focalPoint=m(this.focalPoint,i.focalPoint),this.distanceVector=m(this.distanceVector,i.distanceVector),this.azimuth=i.azimuth,this.elevation=i.elevation,this.roll=i.roll,this.relAzimuth=i.relAzimuth,this.relElevation=i.relElevation,this.relRoll=i.relRoll,this.dollyingStep=i.dollyingStep,this.distance=i.distance,this.zoom=i.zoom},r}(Y);V.CameraContribution=nt;
