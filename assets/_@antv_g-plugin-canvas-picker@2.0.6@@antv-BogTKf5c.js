import{_ as Z,a as z,b as E,d as G,g as J,h as q,f as O}from"./_tslib@2.6.3@tslib-Ck5hgXZz.js";import{S as I,A as p,o as W,q as X,t as Y,u as j}from"./_@antv_g-lite@2.0.5@@antv-O0rSGUp-.js";import{e as K,f as rr,g as N,h as er}from"./_@antv_g-math@3.0.0@@antv-CUxi46E3.js";import{g as tr,K as ar}from"./_@antv_util@3.3.7@@antv-rk1Gsl7O.js";import{y as w,e as nr,k as ir,R as or,X as B}from"./_gl-matrix@3.4.3@gl-matrix-Cx0TVU2o.js";var vr=w(),fr=w(),ur=w(),sr=nr(),cr=function(){function a(){var r=this;this.isHit=function(t,e,o,n){var i=r.context.pointInPathPickerFactory[t.nodeName];if(i){var v=ir(sr,o),f=or(fr,B(ur,e[0],e[1],0),v);if(i(t,new Y(f[0],f[1]),n,r.isPointInPath,r.context,r.runtime))return!0}return!1},this.isPointInPath=function(t,e){var o=r.runtime.offscreenCanvasCreator.getOrCreateContext(r.context.config.offscreenCanvas),n=r.context.pathGeneratorFactory[t.nodeName];return n&&(o.beginPath(),n(o,t.parsedStyle),o.closePath()),o.isPointInPath(e.x,e.y)}}return a.prototype.apply=function(r,t){var e=this,o,n=r.renderingService,i=r.renderingContext;this.context=r,this.runtime=t;var v=(o=i.root)===null||o===void 0?void 0:o.ownerDocument;n.hooks.pick.tapPromise(a.tag,function(f){return J(e,void 0,void 0,function(){return q(this,function(u){return[2,this.pick(v,f)]})})}),n.hooks.pickSync.tap(a.tag,function(f){return e.pick(v,f)})},a.prototype.pick=function(r,t){var e,o,n=t.topmost,i=t.position,v=i.x,f=i.y,u=B(vr,v,f,0),s=r.elementsFromBBox(u[0],u[1],u[0],u[1]),c=[];try{for(var l=O(s),P=l.next();!P.done;P=l.next()){var h=P.value,g=h.getWorldTransform(),_=this.isHit(h,u,g,!1);if(_){var d=j(h);if(d){var k=d.parsedStyle.clipPath,y=this.isHit(k,u,k.getWorldTransform(),!0);if(y){if(n)return t.picked=[h],t;c.push(h)}}else{if(n)return t.picked=[h],t;c.push(h)}}}}catch(F){e={error:F}}finally{try{P&&!P.done&&(o=l.return)&&o.call(l)}finally{if(e)throw e.error}}return t.picked=c,t},a.tag="CanvasPicker",a}();function lr(a,r,t){var e=a.parsedStyle,o=e.cx,n=o===void 0?0:o,i=e.cy,v=i===void 0?0:i,f=e.r,u=e.fill,s=e.stroke,c=e.lineWidth,l=c===void 0?1:c,P=e.increasedLineWidthForHitTesting,h=P===void 0?0:P,g=e.pointerEvents,_=g===void 0?"auto":g,d=(l+h)/2,k=K(n,v,r.x,r.y),y=E(W(_,u,s),2),F=y[0],x=y[1];return F&&x||t?k<=f+d:F?k<=f:x?k>=f-d&&k<=f+d:!1}function b(a,r,t,e){return a/(t*t)+r/(e*e)}function dr(a,r,t){var e=a.parsedStyle,o=e.cx,n=o===void 0?0:o,i=e.cy,v=i===void 0?0:i,f=e.rx,u=e.ry,s=e.fill,c=e.stroke,l=e.lineWidth,P=l===void 0?1:l,h=e.increasedLineWidthForHitTesting,g=h===void 0?0:h,_=e.pointerEvents,d=_===void 0?"auto":_,k=r.x,y=r.y,F=E(W(d,s,c),2),x=F[0],H=F[1],M=(P+g)/2,S=(k-n)*(k-n),L=(y-v)*(y-v);return x&&H||t?b(S,L,f+M,u+M)<=1:x?b(S,L,f,u)<=1:H?b(S,L,f-M,u-M)>=1&&b(S,L,f+M,u+M)<=1:!1}function T(a,r,t,e,o,n){return o>=a&&o<=a+t&&n>=r&&n<=r+e}function hr(a,r,t,e,o,n,i){var v=o/2;return T(a-v,r-v,t,o,n,i)||T(a+t-v,r-v,o,e,n,i)||T(a+v,r+e-v,t,o,n,i)||T(a-v,r+v,o,e,n,i)}function $(a,r,t,e,o,n,i,v){var f=(Math.atan2(v-r,i-a)+Math.PI*2)%(Math.PI*2),u={x:a+t*Math.cos(f),y:r+t*Math.sin(f)};return K(u.x,u.y,i,v)<=n/2}function C(a,r,t,e,o,n,i){var v=Math.min(a,t),f=Math.max(a,t),u=Math.min(r,e),s=Math.max(r,e),c=o/2;return n>=v-c&&n<=f+c&&i>=u-c&&i<=s+c?rr(a,r,t,e,n,i)<=o/2:!1}function Q(a,r,t,e,o){var n=a.length;if(n<2)return!1;for(var i=0;i<n-1;i++){var v=a[i][0],f=a[i][1],u=a[i+1][0],s=a[i+1][1];if(C(v,f,u,s,r,t,e))return!0}if(o){var c=a[0],l=a[n-1];if(C(c[0],c[1],l[0],l[1],r,t,e))return!0}return!1}var Pr=1e-6;function m(a){return Math.abs(a)<Pr?0:a<0?-1:1}function gr(a,r,t){return(t[0]-a[0])*(r[1]-a[1])===(r[0]-a[0])*(t[1]-a[1])&&Math.min(a[0],r[0])<=t[0]&&t[0]<=Math.max(a[0],r[0])&&Math.min(a[1],r[1])<=t[1]&&t[1]<=Math.max(a[1],r[1])}function U(a,r,t){var e=!1,o=a.length;if(o<=2)return!1;for(var n=0;n<o;n++){var i=a[n],v=a[(n+1)%o];if(gr(i,v,[r,t]))return!0;m(i[1]-t)>0!=m(v[1]-t)>0&&m(r-(t-i[1])*(i[0]-v[0])/(i[1]-v[1])-i[0])<0&&(e=!e)}return e}function V(a,r,t){for(var e=!1,o=0;o<a.length;o++){var n=a[o];if(e=U(n,r,t),e)break}return e}function _r(a,r,t){var e=a.parsedStyle,o=e.x1,n=e.y1,i=e.x2,v=e.y2,f=e.lineWidth,u=f===void 0?1:f,s=e.increasedLineWidthForHitTesting,c=s===void 0?0:s,l=e.pointerEvents,P=l===void 0?"auto":l,h=e.fill,g=e.stroke,_=E(W(P,h,g),2),d=_[1];return!d&&!t||!u?!1:C(o,n,i,v,u+c,r.x,r.y)}function kr(a,r,t,e,o){for(var n=!1,i=r/2,v=0;v<a.length;v++){var f=a[v],u=f.currentPoint,s=f.params,c=f.prePoint,l=f.box;if(!(l&&!T(l.x-i,l.y-i,l.width+r,l.height+r,t,e)))switch(f.command){case"L":case"Z":if(n=C(c[0],c[1],u[0],u[1],r,t,e),n)return!0;break;case"Q":var P=er(c[0],c[1],s[1],s[2],s[3],s[4],t,e);if(n=P<=r/2,n)return!0;break;case"C":var h=N(c[0],c[1],s[1],s[2],s[3],s[4],s[5],s[6],t,e,o);if(n=h<=r/2,n)return!0;break;case"A":f.cubicParams||(f.cubicParams=ar(c[0],c[1],s[1],s[2],s[3],s[4],s[5],s[6],s[7],void 0));for(var g=f.cubicParams,_=c,d=0;d<g.length;d+=6){var k=N(_[0],_[1],g[d],g[d+1],g[d+2],g[d+3],g[d+4],g[d+5],t,e,o);if(_=[g[d+4],g[d+5]],n=k<=r/2,n)return!0}break}}return n}function yr(a,r,t,e,o,n){var i=a.parsedStyle,v=i.lineWidth,f=v===void 0?1:v,u=i.increasedLineWidthForHitTesting,s=u===void 0?0:u,c=i.stroke,l=i.fill,P=i.d,h=i.pointerEvents,g=h===void 0?"auto":h,_=P.segments,d=P.hasArc,k=P.polylines,y=P.polygons,F=E(W(g,(y==null?void 0:y.length)&&l,c),2),x=F[0],H=F[1],M=X(a),S=!1;return x||t?(d?S=e(a,r):S=V(y,r.x,r.y)||V(k,r.x,r.y),S):((H||t)&&(S=kr(_,f+s,r.x,r.y,M)),S)}function Ir(a,r,t){var e=a.parsedStyle,o=e.stroke,n=e.fill,i=e.lineWidth,v=i===void 0?1:i,f=e.increasedLineWidthForHitTesting,u=f===void 0?0:f,s=e.points,c=e.pointerEvents,l=c===void 0?"auto":c,P=E(W(l,n,o),2),h=P[0],g=P[1],_=!1;return(g||t)&&(_=Q(s.points,v+u,r.x,r.y,!0)),!_&&(h||t)&&(_=U(s.points,r.x,r.y)),_}function Fr(a,r,t){var e=a.parsedStyle,o=e.lineWidth,n=o===void 0?1:o,i=e.increasedLineWidthForHitTesting,v=i===void 0?0:i,f=e.points,u=e.pointerEvents,s=u===void 0?"auto":u,c=e.fill,l=e.stroke,P=E(W(s,c,l),2),h=P[1];return!h&&!t||!n?!1:Q(f.points,n+v,r.x,r.y,!1)}function Mr(a,r,t,e,o){var n=a.parsedStyle,i=n.radius,v=n.fill,f=n.stroke,u=n.lineWidth,s=u===void 0?1:u,c=n.increasedLineWidthForHitTesting,l=c===void 0?0:c,P=n.x,h=P===void 0?0:P,g=n.y,_=g===void 0?0:g,d=n.width,k=n.height,y=n.pointerEvents,F=y===void 0?"auto":y,x=E(W(F,v,f),2),H=x[0],M=x[1],S=i&&i.some(function(D){return D!==0}),L=s+l;if(S){var R=!1;return(M||t)&&(R=Sr(h,_,d,k,i.map(function(D){return tr(D,0,Math.min(Math.abs(d)/2,Math.abs(k)/2))}),L,r.x,r.y)),!R&&(H||t)&&(R=e(a,r)),R}else{var A=L/2;if(H&&M||t)return T(h-A,_-A,d+A,k+A,r.x,r.y);if(H)return T(h,_,d,k,r.x,r.y);if(M)return hr(h,_,d,k,L,r.x,r.y)}return!1}function Sr(a,r,t,e,o,n,i,v){var f=E(o,4),u=f[0],s=f[1],c=f[2],l=f[3];return C(a+u,r,a+t-s,r,n,i,v)||C(a+t,r+s,a+t,r+e-c,n,i,v)||C(a+t-c,r+e,a+l,r+e,n,i,v)||C(a,r+e-l,a,r+u,n,i,v)||$(a+t-s,r+s,s,1.5*Math.PI,2*Math.PI,n,i,v)||$(a+t-c,r+e-c,c,0,.5*Math.PI,n,i,v)||$(a+l,r+e-l,l,.5*Math.PI,Math.PI,n,i,v)||$(a+u,r+u,u,Math.PI,1.5*Math.PI,n,i,v)}function xr(a,r,t,e,o,n){var i=a.parsedStyle,v=i.pointerEvents,f=v===void 0?"auto":v,u=i.x,s=u===void 0?0:u,c=i.y,l=c===void 0?0:c,P=i.width,h=i.height;if(f==="non-transparent-pixel"){var g=o.config.offscreenCanvas,_=n.offscreenCanvasCreator.getOrCreateCanvas(g),d=n.offscreenCanvasCreator.getOrCreateContext(g,{willReadFrequently:!0});_.width=P,_.height=h,o.defaultStyleRendererFactory[I.IMAGE].render(d,G(G({},a.parsedStyle),{x:0,y:0}),a,void 0,void 0,void 0);var k=d.getImageData(r.x-s,r.y-l,1,1).data;return k.every(function(y){return y!==0})}return!0}var Wr=function(a){Z(r,a);function r(){var t=a.apply(this,z([],E(arguments),!1))||this;return t.name="canvas-picker",t}return r.prototype.init=function(){var t,e=function(){return!0},o=(t={},t[I.CIRCLE]=lr,t[I.ELLIPSE]=dr,t[I.RECT]=Mr,t[I.LINE]=_r,t[I.POLYLINE]=Fr,t[I.POLYGON]=Ir,t[I.PATH]=yr,t[I.TEXT]=e,t[I.GROUP]=null,t[I.IMAGE]=xr,t[I.HTML]=null,t[I.MESH]=null,t);this.context.pointInPathPickerFactory=o,this.addRenderingPlugin(new cr)},r.prototype.destroy=function(){delete this.context.pointInPathPickerFactory,this.removeAllRenderingPlugins()},r}(p);export{Wr as P};
